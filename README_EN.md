# ğŸŒŸ PebbleDrive - Lightweight Cloud Storage

[ä¸­æ–‡](README.md) | **English** | **[ğŸ­ Live Demo](https://aydomini.github.io/pebble-drive/)**

> ğŸš€ **Free Private Cloud Storage Based on Cloudflare Workers**
>
> **Serverless Architecture** | **Global CDN** | **Enterprise Security**

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Cloudflare Workers](https://img.shields.io/badge/Cloudflare-Workers-orange.svg)](https://workers.cloudflare.com/)
[![Demo](https://img.shields.io/badge/demo-online-brightgreen.svg)](https://aydomini.github.io/pebble-drive/)

---

## ğŸ“‹ Core Features

- ğŸš€ **Serverless Architecture** - Cloudflare Workers edge computing, 100k free requests/day
- ğŸ“¦ **Triple Storage System** - R2 (files) + D1 (metadata) + KV (rate limiting)
- ğŸ“¤ **Smart Upload** - Drag-and-drop, simple upload max 200MB, chunked upload max 5GB
- ğŸ”— **Flexible Sharing** - Standard/short link switching, password protection, time-limited downloads
- ğŸ‘ï¸ **File Preview** - Images, PDF, Markdown, code highlighting, SVG
- ğŸ” **Security** - SHA-256 hashing, rate limiting, Turnstile verification
- ğŸŒ **Multi-Language** - Chinese/English adaptive
- ğŸŒ“ **Theme Switching** - Light/Dark mode
- ğŸ“± **Responsive** - Perfect for desktop/tablet/mobile

---

## ğŸ—ï¸ Architecture

```
User â†’ Pages (Frontend) â†’ Workers (Backend) â†’ R2 + D1 + KV
```

| Storage | Purpose | Free Tier |
|---------|---------|-----------|
| **R2** | File content, no egress fees | 10GB |
| **D1** | File metadata, complex queries | 5GB |
| **KV** | Rate limiting, millisecond reads | 1GB |

**Tech Stack**: Vite + Vanilla JS + TailwindCSS + Cloudflare Workers

---

## ğŸš€ Quick Start

### Option 1: One-Click Deploy (Backend + Frontend) â­ Easiest

[![Deploy to Cloudflare Workers](https://deploy.workers.cloudflare.com/button)](https://deploy.workers.cloudflare.com/?url=https://github.com/aydomini/pebble-drive)

**ğŸ‰ True One-Click Deployment! After clicking the button**:

1. Login to your Cloudflare account
2. System automatically creates resources (D1, R2, KV)
3. âœ… **Auto-build and deploy Frontend**
4. âœ… **Auto-deploy Backend API**
5. âœ… **Database auto-initialized**
6. âœ… **Temporary password set**: `TEMP_PASSWORD_CHANGE_ME`

**Access URL**: `https://pebble-drive.{your-subdomain}.workers.dev`

**Architecture**:

- ğŸ“¦ Frontend + Backend deployed to **single Worker** (using Workers Assets)
- âœ… Unified domain (no CORS issues)
- âœ… Code still separated (frontend/ + backend/ independent development)
- âœ… **Cache-busting migrated**: From Pages Functions to Worker middleware
- âš ï¸ Code size limit: 1MB compressed (current ~700KB, sufficient)

**ğŸ”§ Technical Details**:

Cache-busting mechanism (share/download core feature):
- âœ… Timestamp redirection (`_t` parameter prevents browser caching)
- âœ… Dynamic time window (desktop 1s/mobile 3s/slow network 5s)
- âœ… Clock skew tolerance (supports client time mismatch)
- âœ… Forced no-cache headers (ensures download limit enforcement)

**âš ï¸ Important: Change Default Password** (Strongly Recommended)

Application is ready, but uses a **temporary password**. Please change it immediately:

1. **Option A: Change in Cloudflare Dashboard** (Recommended)
   - Visit: [Workers & Pages](https://dash.cloudflare.com/) â†’ `pebble-drive-api` â†’ Settings â†’ Variables
   - Change `AUTH_PASSWORD` to your secure password
   - Change `AUTH_TOKEN_SECRET` to a random string (e.g., generated by `openssl rand -base64 32`)

2. **Option B: Change via CLI** (More Secure)

   ```bash
   cd backend

   # Override with secure password
   echo "your-secure-password" | npx wrangler secret put AUTH_PASSWORD

   # Override with random JWT secret
   openssl rand -base64 32 | npx wrangler secret put AUTH_TOKEN_SECRET

   # Configure Turnstile (optional)
   echo "your-turnstile-secret" | npx wrangler secret put TURNSTILE_SECRET_KEY
   ```

---

### Option 2: GitHub Actions One-Click Deploy â­ Recommended

[![Deploy with GitHub Actions](https://img.shields.io/badge/Deploy-GitHub%20Actions-2088FF?logo=github-actions&logoColor=white)](../../actions/workflows/deploy.yml)

1. **Fork this repository** to your GitHub account
2. **Configure GitHub Secrets** (Settings â†’ Secrets and variables â†’ Actions):
   - `CLOUDFLARE_API_TOKEN`: [Get API Token](https://dash.cloudflare.com/profile/api-tokens)
   - `CLOUDFLARE_ACCOUNT_ID`: [View Account ID](https://dash.cloudflare.com/)
   - `TURNSTILE_SITE_KEY` (optional): [Create Turnstile](https://dash.cloudflare.com/?to=/:account/turnstile)

3. **Click Actions** â†’ **Deploy PebbleDrive** â†’ **Run workflow**
   - Optional configs: file size limit, storage quota, upload limit, project name

4. **Configure login password** (run locally):

   ```bash
   cd backend
   echo "your-password" | npx wrangler secret put AUTH_PASSWORD
   openssl rand -base64 32 | npx wrangler secret put AUTH_TOKEN_SECRET
   ```

ğŸ‰ Done! Visit the deployment URL to start using.

---

### Option 3: Local CLI Deploy

```bash
# 1. Clone the project
git clone https://github.com/aydomini/pebble-drive.git
cd pebble-drive

# 2. Login to Cloudflare
npx wrangler login

# 3. One-click deploy
npm run deploy

# 4. Set password (required for first deployment)
cd backend
echo "your-password" | npx wrangler secret put AUTH_PASSWORD
openssl rand -base64 32 | npx wrangler secret put AUTH_TOKEN_SECRET
```

ğŸ‰ Done! Visit the output URL to start using.

---

### ğŸ“Š Deployment Mode Comparison

| Feature | Option 1: One-Click Deploy | Option 2/3: Separate Deploy |
|---------|---------------------------|----------------------------|
| **Complexity** | â­â­â­â­â­ Easiest | â­â­â­ Multiple configs |
| **Deploy Time** | ~2 minutes | ~16 minutes |
| **Domain** | Single domain | Two domains (need BACKEND_URL) |
| **Cache-busting** | Worker middleware | Pages Functions |
| **Best For** | Beginners, quick deploy | Large projects, team collaboration |

**Recommended**: 90% of users should use **Option 1 (One-Click Deploy)**

---

ğŸ“š **Detailed Deployment Guide**: [DEPLOY.md](DEPLOY.md)

---

## ğŸ“– Documentation

| Document | Description |
|----------|-------------|
| [DEPLOY.md](DEPLOY.md) | Complete deployment guide (backend/frontend/short link) |
| [CHANGELOG.md](CHANGELOG.md) | Version changelog |

---

## ğŸ“„ License

MIT License - See [LICENSE](LICENSE)

---

## ğŸ™ Acknowledgments

Thanks to the following open-source projects and services:

- [Cloudflare Workers](https://workers.cloudflare.com/) - Serverless platform
- [TailwindCSS](https://tailwindcss.com/) - CSS framework
- [Vite](https://vitejs.dev/) - Frontend build tool
- [Marked.js](https://marked.js.org/) - Markdown parser
- [Highlight.js](https://highlightjs.org/) - Code highlighting
- [FontAwesome](https://fontawesome.com/) - Icon library

---

## â­ Star History

[![Star History Chart](https://api.star-history.com/svg?repos=aydomini/pebble-drive&type=Date)](https://star-history.com/#aydomini/pebble-drive&Date)

---

**Built with â¤ï¸ using Cloudflare Workers**
