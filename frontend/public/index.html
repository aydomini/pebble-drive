<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PebbleDrive - 轻量级云存储</title>

    <!-- PWA 支持 -->
    <link rel="manifest" href="/manifest.json">
    <!-- theme-color 自动适配主题（JavaScript 动态更新） -->
    <meta name="theme-color" content="#f9fafb" id="theme-color-meta">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PebbleDrive">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">

    <!-- SEO 优化 -->
    <meta name="description" content="基于 Cloudflare 的免费轻量级私人云存储，支持文件上传、分享、预览，完全免费，全球CDN加速">
    <meta name="keywords" content="云存储,文件分享,Cloudflare,免费存储,PWA,私人云盘">
    <meta name="author" content="PebbleDrive">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="PebbleDrive - 轻量级云存储">
    <meta property="og:description" content="基于 Cloudflare 的免费轻量级私人云存储">
    <meta property="og:image" content="/logo.svg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="PebbleDrive - 轻量级云存储">
    <meta property="twitter:description" content="基于 Cloudflare 的免费轻量级私人云存储">
    <meta property="twitter:image" content="/logo.svg">

    <script>
        // 隐藏 Vite 开发服务器的连接日志
        (function() {
            const originalLog = console.log;
            console.log = function(...args) {
                // 过滤掉 Vite 的连接消息
                const message = args[0];
                if (typeof message === 'string' && (
                    message.includes('[vite] connecting') ||
                    message.includes('[vite] connected')
                )) {
                    return; // 不输出
                }
                originalLog.apply(console, args);
            };
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CDN 配置
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdown 解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 代码高亮库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-light">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-dark" disabled>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        /* 夜间主题变量 */
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        .dark {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #4b5563;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        /* 基础样式使用 CSS 变量 */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            /* 禁止 body 过度滚动（防止 iOS 橡皮筋效果） */
            overscroll-behavior: none;
            overflow: hidden;
            height: 100vh;
            height: 100dvh; /* 使用动态视口高度 */
            /* PWA 专用：固定定位 + 禁止触摸滚动 */
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            touch-action: none; /* 禁止所有触摸手势 */
        }

        /* 允许内容区域的触摸滚动 */
        main,
        #fileList,
        #previewArea,
        #mobilePreviewArea,
        .overflow-auto,
        .overflow-y-auto {
            touch-action: pan-y pan-x; /* 允许垂直和水平滚动 */
        }

        .drag-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .drag-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .dark .drag-area.dragover {
            background-color: #1e3a8a;
        }
        .file-item {
            transition: all 0.2s ease;
        }
        .file-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* Markdown 和代码预览样式 */
        .markdown-preview {
            line-height: 1.6;
        }
        .markdown-preview h1 { font-size: 2em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .markdown-preview h2 { font-size: 1.5em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .markdown-preview h3 { font-size: 1.25em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
        .markdown-preview p { margin-bottom: 1em; }
        .markdown-preview ul, .markdown-preview ol { margin-left: 2em; margin-bottom: 1em; }
        .markdown-preview li { margin-bottom: 0.25em; }
        .markdown-preview code { background-color: #f3f4f6; padding: 0.2em 0.4em; border-radius: 3px; font-size: 0.9em; }
        .markdown-preview pre { background-color: #f6f8fa; padding: 1em; border-radius: 6px; overflow-x: hidden; overflow-y: auto; white-space: pre-wrap; word-break: break-word; margin-bottom: 1em; }
        .dark .markdown-preview code { background-color: #374151; color: #e5e7eb; }
        .dark .markdown-preview pre { background-color: #1f2937; }
        .markdown-preview pre code { background-color: transparent; padding: 0; }
        .markdown-preview blockquote { border-left: 4px solid #e5e7eb; padding-left: 1em; margin-left: 0; color: #6b7280; }
        .dark .markdown-preview blockquote { border-left-color: #4b5563; color: #9ca3af; }
        .markdown-preview a { color: #2563eb; text-decoration: underline; }
        .dark .markdown-preview a { color: #60a5fa; }
        .markdown-preview table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
        .markdown-preview th, .markdown-preview td { border: 1px solid #e5e7eb; padding: 0.5em; }
        .dark .markdown-preview th, .dark .markdown-preview td { border-color: #4b5563; }
        .markdown-preview th { background-color: #f9fafb; font-weight: bold; }
        .dark .markdown-preview th { background-color: #374151; }

        /* 自定义滚动条样式（支持夜间模式） */
        /* Webkit 浏览器 (Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
            transition: background 0.2s;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 夜间模式滚动条 */
        .dark ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Firefox 滚动条 */
        * {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        .dark * {
            scrollbar-color: #4b5563 #1f2937;
        }

        /* 预览区域专用滚动条样式（更明显） */
        #previewArea::-webkit-scrollbar,
        #mobilePreviewArea::-webkit-scrollbar {
            width: 10px;
        }
        #previewArea::-webkit-scrollbar-track,
        #mobilePreviewArea::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 5px;
        }
        #previewArea::-webkit-scrollbar-thumb,
        #mobilePreviewArea::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 5px;
        }
        #previewArea::-webkit-scrollbar-thumb:hover,
        #mobilePreviewArea::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* 夜间模式预览区域滚动条 */
        .dark #previewArea::-webkit-scrollbar-track,
        .dark #mobilePreviewArea::-webkit-scrollbar-track {
            background: #374151;
        }
        .dark #previewArea::-webkit-scrollbar-thumb,
        .dark #mobilePreviewArea::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        .dark #previewArea::-webkit-scrollbar-thumb:hover,
        .dark #mobilePreviewArea::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* Turnstile 验证框样式约束 */
        #turnstile-container {
            max-width: 100%;
            box-sizing: border-box;
        }
        /* 强制 Turnstile iframe 不超出容器 */
        #turnstile-container iframe {
            max-width: 100% !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        /* 在小屏幕上使用 transform scale 缩放 Turnstile */
        @media (max-width: 400px) {
            #turnstile-container > div {
                transform-origin: 0 0;
                width: 300px !important; /* Turnstile normal 固定宽度 */
            }
        }

        /* ==========================================
           抽屉式菜单样式（手机横屏优化）
           ========================================== */
        /* 抽屉容器 */
        #fabDrawer {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 抽屉主体 */
        .drawer-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px; /* 按钮和面板之间的间距 */
            padding-right: 8px; /* 右侧留出边距 */
        }

        /* 触发按钮（左侧凸出部分 - 动态透明度） */
        .drawer-toggle {
            position: absolute;
            left: -34px; /* 调整位置以适应完整圆角 */
            width: 30px;
            height: 80px;
            background: rgba(255, 255, 255, 0.6); /* 关闭时：60% 不透明 */
            border-radius: 8px; /* 完整圆角矩形 */
            box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
            backdrop-filter: blur(8px); /* 毛玻璃效果 */
            -webkit-backdrop-filter: blur(8px);
        }

        .dark .drawer-toggle {
            background: rgba(31, 41, 55, 0.6); /* 深色模式关闭时：60% 不透明 */
            box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.4);
        }

        /* 抽屉打开时：透明度提升到 80% */
        .drawer-open .drawer-toggle {
            background: rgba(255, 255, 255, 0.8); /* 打开时：80% 不透明 */
        }

        .dark .drawer-open .drawer-toggle {
            background: rgba(31, 41, 55, 0.8); /* 深色模式打开时：80% 不透明 */
        }

        .drawer-toggle:hover {
            background: rgba(243, 244, 246, 0.8); /* 悬停：浅灰色 80% */
            left: -36px;
        }

        .dark .drawer-toggle:hover {
            background: rgba(55, 65, 81, 0.8); /* 深色模式悬停：稍亮的灰色 80% */
        }

        /* 打开时悬停：进一步提升透明度到 90% */
        .drawer-open .drawer-toggle:hover {
            background: rgba(243, 244, 246, 0.9);
        }

        .dark .drawer-open .drawer-toggle:hover {
            background: rgba(55, 65, 81, 0.9);
        }

        .drawer-toggle i {
            color: #6b7280; /* 图标：中灰色 */
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .dark .drawer-toggle i {
            color: #9ca3af; /* 深色模式图标：浅灰色 */
        }

        /* 抽屉打开时箭头旋转 */
        .drawer-open .drawer-toggle i {
            transform: rotate(180deg);
        }

        /* 抽屉面板（完整圆角矩形） */
        .drawer-panel {
            background: white;
            border-radius: 8px; /* 完整圆角矩形 */
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 48px;
        }

        .dark .drawer-panel {
            background: #1f2937;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.4);
        }

        /* 功能按钮 */
        .drawer-panel button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: #f3f4f6;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
        }

        .dark .drawer-panel button {
            background: #374151;
        }

        .drawer-panel button:hover {
            background: #e5e7eb;
            transform: scale(1.05);
        }

        .dark .drawer-panel button:hover {
            background: #4b5563;
        }

        .drawer-panel button i {
            color: #6b7280;
            font-size: 16px;
        }

        .dark .drawer-panel button i {
            color: #9ca3af;
        }

        /* 登出按钮特殊颜色 */
        .drawer-panel button:last-child:hover {
            background: #fee2e2;
        }

        .dark .drawer-panel button:last-child:hover {
            background: #7f1d1d;
        }

        .drawer-panel button:last-child i {
            color: #dc2626;
        }

        .dark .drawer-panel button:last-child i {
            color: #ef4444;
        }

        /* ==========================================
           分享面板全局紧凑设计（所有设备统一，放大40%版本）
           ========================================== */
        /* 确保外层容器正确居中（考虑移动端地址栏） */
        #fileModal > div {
            padding: 1rem !important; /* 16px，保持呼吸空间 */
            min-height: 100dvh !important; /* 使用动态视口高度（考虑地址栏） */
            height: 100dvh !important; /* 固定高度为动态视口 */
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        /* 隐藏标题区域，节省空间 */
        #fileModal .flex.items-center.justify-between.mb-4 {
            display: none !important;
        }

        /* 模态框紧凑设计（放大40%，增加内边距） */
        #fileModal > div > div {
            max-height: 95dvh !important; /* 使用动态视口高度 */
            max-width: 392px !important; /* 宽度从 280px 增加 40% */
            padding: 1rem !important; /* 16px，舒适的内边距 */
        }

        /* 统一字体大小为 14px（从 10px 放大 40%） */
        #fileModal,
        #fileModal * {
            font-size: 0.875rem !important; /* 14px */
        }

        /* 分享面板所有间距（放大40%） */
        #fileModal .space-y-1\.5 > * + * {
            margin-top: 0.35rem !important; /* 约6px，从4px增加 */
        }

        /* 文件名区域（放大40%） */
        #fileModal .bg-gray-50,
        #fileModal .dark\:bg-gray-700 {
            padding: 0.35rem 0.5rem !important; /* 从 4px 6px 增加 */
        }

        /* 标签（放大40%） */
        #fileModal label {
            margin-bottom: 0.175rem !important; /* 约3px，从2px增加 */
        }

        /* 输入框和选择框（放大40%） */
        #fileModal input,
        #fileModal select {
            padding: 0.175rem 0.5rem !important; /* 从 2px 6px 增加 */
            min-height: 28px !important; /* 从 20px 增加 */
        }

        /* 按钮（放大40%） */
        #fileModal button {
            padding: 0.35rem 0.5rem !important; /* 从 4px 6px 增加 */
            min-height: 28px !important; /* 从 20px 增加 */
        }

        /* 按钮间距（放大40%） */
        #fileModal .gap-1 {
            gap: 0.35rem !important; /* 约6px，从4px增加 */
        }

        #fileModal .gap-1\.5 {
            gap: 0.5rem !important; /* 8px，从6px增加 */
        }

        /* ==========================================
           手机横屏模式优化（方案 E：终极组合）
           ========================================== */
        /* 精确检测：手机横屏全屏模式（排除分屏场景） */
        @media (orientation: landscape)
           and (max-height: 500px)
           and (min-width: 600px)        /* 宽度至少 600px，排除分屏 */
           and (max-width: 900px)
           and (hover: none)
           and (pointer: coarse) {

            /* 隐藏 Header */
            #appScreen header {
                display: none !important;
            }

            /* 显示抽屉式菜单 */
            #fabDrawer {
                display: block !important;
            }

            /* 减小 main 的 padding */
            main {
                padding: 0.5rem !important;
            }

            /* 重新计算内容高度（去掉 Header 的 56px） */
            main > div > div {
                height: calc(100dvh - 16px) !important; /* 16px = padding 上下 8px * 2 */
            }

            /* 压缩卡片 header 高度 */
            .bg-white .px-4.py-3,
            .dark\:bg-gray-800 .px-4.py-3 {
                padding-top: 0.375rem !important;    /* py-1.5 = 6px */
                padding-bottom: 0.375rem !important;
            }

            /* 压缩卡片 header 字体 */
            .bg-white .px-4.py-3 h2,
            .dark\:bg-gray-800 .px-4.py-3 h2 {
                font-size: 0.75rem !important; /* text-xs */
            }

            /* 压缩卡片 header 图标 */
            .bg-white .px-4.py-3 i,
            .dark\:bg-gray-800 .px-4.py-3 i {
                font-size: 0.65rem !important;
            }

            /* 压缩存储信息文字 */
            #storageInfo {
                font-size: 0.625rem !important; /* 更小 */
            }

            /* ==========================================
               优化 2：隐藏文件列表搜索栏
               ========================================== */
            /* 隐藏搜索输入框、排序、刷新按钮 */
            #searchInput,
            #sortBy,
            #refreshBtn {
                display: none !important;
            }

            /* 移除工具栏外层容器的 padding（px-4 py-2 容器）*/
            .px-4.py-2.bg-white.flex-shrink-0,
            .dark .px-4.py-2.dark\:bg-gray-800.flex-shrink-0 {
                padding: 0 !important;
            }

            /* 如果工具栏为空，隐藏整个工具栏容器 */
            .flex.items-center.justify-between.space-x-1 {
                min-height: 0 !important;
                padding: 0 !important;
            }

            /* ==========================================
               优化 5：禁用文件项hover效果（修复触摸后浅蓝色背景持久化）
               ========================================== */
            /* 移动设备触摸后hover伪类会持久化，导致浅蓝色背景不消失 */
            /* 使用 :not(.selected) 选择器，只在非选中状态下禁用hover */
            .file-item:not(.selected):hover {
                background-color: transparent !important;
            }
            /* 深色模式下也禁用hover效果（仅非选中状态） */
            .dark .file-item:not(.selected):hover {
                background-color: transparent !important;
            }

            /* 压缩文件列表项高度 */
            .file-item {
                padding-top: 0.25rem !important;   /* 4px，从 8px 进一步压缩 */
                padding-bottom: 0.25rem !important; /* 4px，从 8px 进一步压缩 */
            }

            /* 压缩文件列表项字体和图标 */
            .file-item i.fas {
                font-size: 1rem !important; /* 16px，从 20px 压缩 */
            }

            .file-item h3 {
                font-size: 0.6875rem !important; /* 11px，从 14px 压缩 */
                line-height: 1.2 !important; /* 紧凑行高 */
            }

            .file-item p {
                font-size: 0.625rem !important; /* 10px，从 12px 压缩 */
                line-height: 1.2 !important; /* 紧凑行高 */
            }

            /* 压缩文件列表按钮 */
            .file-item button {
                padding: 0.25rem !important; /* 4px，从 6px 压缩 */
            }

            .file-item button i {
                font-size: 0.75rem !important; /* 12px，从 14px 压缩 */
            }

            /* ==========================================
               优化 4：收缩上传虚线框
               ========================================== */
            /* 进一步缩减虚线框高度至 35px，只显示图标 */
            #dragArea {
                min-height: 35px !important; /* 从 50px 进一步缩减到 35px */
                padding: 0.25rem !important; /* 统一 padding 为 4px */
                flex-direction: row !important;
                gap: 0 !important; /* 移除间距 */
            }

            /* 图标居中显示 */
            #dragArea i {
                font-size: 1rem !important; /* 稍大的图标作为唯一视觉元素 */
            }

            /* 隐藏所有文字提示 */
            #dragArea > div {
                display: none !important; /* 隐藏包含文字的 div */
            }

            /* 压缩上传卡片的整体高度 */
            .flex-\[1\] {
                flex: 1 !important; /* 上传卡片占比 */
            }

            .flex-\[2\] {
                flex: 2 !important; /* 文件列表占比 */
            }

            /* ==========================================
               优化 3：精简预览信息显示（进一步优化）
               ========================================== */
            /* 隐藏预览区域的文件名、类型、大小、时间等所有信息 */
            .preview-name,
            .preview-info {
                display: none !important;
            }

            /* 调整按钮位置，移除顶部 margin */
            .flex.gap-2.mt-3 {
                margin-top: 0 !important;
            }
        }
    </style>
    <!-- Cloudflare Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col transition-colors">
    <!-- 登录界面（默认显示） -->
    <div id="loginScreen" class="flex-1 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md transition-colors">
            <div class="flex items-center justify-center gap-3 mb-8">
                <!-- Logo -->
                <img src="/logo.svg" alt="PebbleDrive" class="w-12 h-12 flex-shrink-0 transition-all" />
                <!-- 标题和副标题 -->
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-2" data-i18n="appTitle">
                        PebbleDrive
                    </h1>
                    <div class="flex items-center">
                        <p class="text-gray-600 dark:text-gray-300" data-i18n="appSubtitle">轻量级云存储</p>
                        <a href="#" id="loginVersionLink" class="text-xs text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition ml-2" target="_blank" rel="noopener noreferrer" title="View on GitHub">
                            v1.3.2
                        </a>
                    </div>
                </div>
            </div>

            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-lock mr-1"></i><span data-i18n="accessPassword">访问密码</span>
                    </label>
                    <input
                        type="password"
                        id="loginPassword"
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-100 transition"
                        placeholder="请输入访问密码"
                        data-i18n-placeholder="passwordPlaceholder"
                        required
                        autocomplete="current-password"
                    >
                </div>

                <!-- Turnstile 容器 (可选，需要配置 Site Key) -->
                <!-- 添加 overflow-hidden 防止溢出，max-w-full 确保不超出父容器 -->
                <div id="turnstile-container" class="hidden w-full overflow-hidden">
                    <!-- Turnstile widget 将在这里渲染 -->
                </div>

                <button
                    type="submit"
                    id="loginBtn"
                    class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center justify-center"
                >
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    <span id="loginBtnText" data-i18n="loginBtn">登录</span>
                </button>

                <div id="loginError" class="hidden bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-4 py-3 rounded-lg text-sm border border-red-200 dark:border-red-800">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span id="loginErrorText"></span>
                </div>
            </form>
        </div>
    </div>

    <!-- 主应用界面（登录后显示） -->
    <div id="appScreen" class="flex-1 flex flex-col" style="display: none;">
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700 transition-colors">
        <div class="max-w-7xl mx-auto px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="/logo.svg" alt="PebbleDrive" class="w-6 h-6 transition-all" />
                    <h1 class="text-xl font-bold text-gray-800 dark:text-gray-100" data-i18n="appTitle">PebbleDrive</h1>
                    <!-- 版本号链接 -->
                    <a href="#" id="appVersionLink" class="text-xs text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition ml-2" target="_blank" rel="noopener noreferrer" title="View on GitHub">
                        v1.3.2
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- 语言切换按钮 -->
                    <button id="langToggle" class="text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition" data-i18n-title="langToggle" title="切换语言">
                        <i class="fas fa-language"></i>
                    </button>
                    <!-- 主题切换按钮 -->
                    <button id="themeToggle" class="text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition" data-i18n-title="themeToggle" title="切换主题">
                        <i class="fas fa-moon dark-icon"></i>
                        <i class="fas fa-sun light-icon hidden"></i>
                    </button>
                    <button id="logoutBtn" class="text-gray-600 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-400 transition" data-i18n-title="logout" title="登出">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 flex p-5 overflow-auto min-h-0">
        <div class="w-full md:max-w-6xl lg:max-w-7xl mx-auto">
            <!-- 卡片式布局：桌面端左右布局，移动端上下布局 -->
            <!-- 所有设备固定高度，避免整页滚动 -->
            <!-- 高度计算：100dvh - Header(56px) - Main padding(40px) = 100dvh - 96px -->
            <!-- 使用 dvh（动态视口高度）自动适配移动端地址栏显示/隐藏 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5 h-[calc(100dvh-96px)]">
                <!-- 左侧列/上方区域：上传卡片 + 文件列表卡片 -->
                <!-- 所有设备填充高度，使用 flex 分配比例 -->
                <div class="md:col-span-1 flex flex-col gap-5 h-full min-h-0">
                    <!-- 上传卡片 (所有设备 flex-1 按比例分配) -->
                    <div class="flex-[1] md:flex-[1] bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden flex flex-col min-h-0 transition-colors">
                        <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                            <h2 class="text-sm font-semibold text-gray-800 dark:text-gray-100">
                                <i class="fas fa-cloud-upload-alt mr-1 text-xs"></i><span data-i18n="upload">上传文件</span>
                            </h2>
                        </div>
                        <div class="flex-1 flex flex-col items-center justify-center p-3 min-h-0 overflow-auto">
                            <div id="dragArea" class="drag-area flex flex-row items-center justify-center gap-2 p-2 text-center w-full h-full min-h-[80px] cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 transition-colors">
                                <i class="fas fa-upload text-sm text-gray-400 dark:text-gray-500"></i>
                                <div class="flex flex-col items-start gap-0.5">
                                    <span class="text-[10px] font-medium text-gray-700 dark:text-gray-300" data-i18n="uploadArea">点击或拖拽</span>
                                    <span class="text-[10px] text-gray-500 dark:text-gray-400" data-i18n="uploadHint">最大 100MB</span>
                                </div>
                                <input type="file" id="fileInput" multiple class="hidden">
                            </div>

                            <!-- 上传进度列表 -->
                            <div id="uploadProgress" class="hidden w-full mt-2">
                                <div class="mb-1 px-2">
                                    <span class="text-xs font-medium text-gray-700 dark:text-gray-300" data-i18n="uploadProgressTitle">上传进度</span>
                                </div>
                                <div id="progressList" class="space-y-1"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 文件列表卡片 (所有设备 flex-2 按比例分配) -->
                    <div class="flex-[2] md:flex-[2] bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden flex flex-col min-h-0 max-h-full transition-colors">
                        <!-- 标题栏：与上传卡片样式统一 -->
                        <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex-shrink-0 flex items-center justify-between">
                            <h2 class="text-sm font-semibold text-gray-800 dark:text-gray-100">
                                <i class="fas fa-folder mr-1 text-xs"></i><span data-i18n="myFiles">我的文件</span>
                            </h2>
                            <span id="storageInfo" class="text-[10px] text-gray-500 dark:text-gray-400">
                                <i class="fas fa-database text-[9px]"></i>
                                <span id="storageUsed">0 KB</span>/<span id="storageTotal">10 GB</span>
                            </span>
                        </div>
                        <!-- 文件列表区域 -->
                        <div class="flex-1 flex flex-col min-h-0">
                            <!-- 搜索和排序工具栏 -->
                            <div class="px-4 py-2 bg-white dark:bg-gray-800 flex-shrink-0">
                                <div class="flex items-center gap-2">
                                    <input type="text" id="searchInput" placeholder="搜索..." data-i18n-placeholder="searchPlaceholder"
                                           class="flex-1 min-w-0 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs leading-tight focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 h-[26px]">
                                    <select id="sortBy" class="flex-shrink-0 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs leading-tight focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-gray-100 h-[26px]">
                                        <option value="name" data-i18n="sortByName">名称</option>
                                        <option value="size" data-i18n="sortBySize">大小</option>
                                        <option value="date" data-i18n="sortByDate">日期</option>
                                    </select>
                                    <button id="refreshBtn" class="flex-shrink-0 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-xs leading-tight bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500 transition h-[26px]">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- 文件列表 -->
                            <div id="fileList" class="flex-1 overflow-y-auto min-h-0">
                                <!-- 文件列表将在这里动态生成 -->
                                <div id="emptyState" class="h-full flex flex-col items-center justify-center text-gray-400 dark:text-gray-500">
                                    <i class="fas fa-folder-open text-3xl mb-2"></i>
                                    <p class="text-xs" data-i18n="emptyState">暂无文件，拖拽或选择文件开始上传</p>
                                </div>
                            </div>
                            <!-- 分页控件 -->
                            <div id="paginationContainer" class="px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">
                                <!-- 分页将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧/隐藏区域：文件预览卡片（桌面端显示，移动端隐藏，通过模态框显示） -->
                <!-- 桌面端填充全部高度 -->
                <div class="hidden md:flex md:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden flex-col min-h-0 md:h-full transition-colors">
                    <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                        <h2 class="text-sm font-semibold text-gray-800 dark:text-gray-100">
                            <i class="fas fa-eye mr-1 text-xs"></i><span data-i18n="preview">文件预览</span>
                        </h2>
                    </div>
                    <div id="previewArea" class="flex-1 p-5 min-h-0 flex flex-col">
                        <div class="h-full flex flex-col items-center justify-center text-gray-400 dark:text-gray-500">
                            <i class="fas fa-file-alt text-4xl mb-3"></i>
                            <p class="text-sm" data-i18n="selectFileToPreview">选择文件查看预览</p>
                            <p class="text-xs mt-1" data-i18n="supportedFormats">支持图片、PDF、Markdown、代码等格式</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 抽屉式菜单（仅手机横屏显示） -->
    <div id="fabDrawer" class="fixed top-1/2 right-0 transform -translate-y-1/2 translate-x-full z-50 hidden">
        <div class="drawer-container">
            <!-- 触发按钮（左侧凸出部分） -->
            <button id="drawerToggle" class="drawer-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
            <!-- 功能按钮面板 -->
            <div id="drawerPanel" class="drawer-panel">
                <button id="drawerLang" data-i18n-title="langToggle" title="切换语言">
                    <i class="fas fa-language"></i>
                </button>
                <button id="drawerTheme" data-i18n-title="themeToggle" title="切换主题">
                    <i class="fas fa-moon dark-icon"></i>
                    <i class="fas fa-sun light-icon hidden"></i>
                </button>
                <button id="drawerLogout" data-i18n-title="logout" title="登出">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 移动端文件预览模态框 -->
    <div id="mobilePreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 md:hidden flex items-center justify-center p-5">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl h-full flex flex-col overflow-hidden">
            <!-- 顶部导航栏 -->
            <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between flex-shrink-0">
                <button id="closeMobilePreview" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100">
                    <i class="fas fa-times text-lg"></i>
                </button>
                <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-100" data-i18n="preview">文件预览</h3>
                <div class="w-6"></div>
            </div>
            <!-- 预览内容 -->
            <div id="mobilePreviewArea" class="flex-1 p-5 bg-gray-50 dark:bg-gray-900 flex flex-col min-h-0"></div>
        </div>
    </div>

    <!-- 文件操作模态框 -->
    <div id="fileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6 flex flex-col" style="max-height: 90vh;">
                <div class="flex items-center justify-between mb-4 flex-shrink-0">
                    <h3 id="modalTitle" class="text-lg font-semibold text-gray-900 dark:text-gray-100">文件信息</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="modalContent" class="flex-1 overflow-y-auto min-h-0"></div>
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 hidden z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 flex items-center space-x-3 border border-gray-200 dark:border-gray-700">
            <i id="toastIcon" class="fas fa-check-circle text-green-500"></i>
            <span id="toastMessage" class="text-gray-800 dark:text-gray-100"></span>
        </div>
    </div>
    </div><!-- 关闭 appScreen -->

    <script>
        // API base URL - 通过环境变量注入或使用默认值
        // 生产环境：需要在构建时设置 VITE_API_BASE_URL 环境变量
        // 开发环境：使用 vite.config.js 中配置的代理
        window.ENV_API_BASE_URL = '%VITE_API_BASE_URL%';

        // Turnstile Site Key - 通过环境变量注入
        // 注意：此变量会被 app.js 中的 window.TURNSTILE_SITE_KEY 使用
        window.VITE_TURNSTILE_SITE_KEY = '%VITE_TURNSTILE_SITE_KEY%';
    </script>
    <script src="js/app.js"></script>

    <!-- Service Worker 注册 -->
    <script>
        // 注册 Service Worker（PWA 支持）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker 注册成功:', registration.scope);

                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[PWA] 发现新版本，准备更新...');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // 新版本已安装，提示用户刷新
                                    console.log('[PWA] 新版本已就绪，请刷新页面');

                                    // 可选：显示更新提示
                                    if (confirm('检测到新版本，是否立即更新？')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('[PWA] Service Worker 注册失败:', error);
                    });

                // 监听 Service Worker 控制权变更
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    console.log('[PWA] Service Worker 已更新');
                });
            });
        }
    </script>
</body>
</html>